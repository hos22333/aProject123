{% extends 'base.html' %}
{% block content %}
<div class="container">
    <div class="page-inner">

        <h2 class="mb-3">Add New Project</h2>
        <form method="post">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-4">{{ form.name }}</div>
                <div class="col-md-4">{{ form.client_name }}</div>
                <div class="col-md-4">{{ form.capacity }}</div>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Save</button>
        </form>
        
        <h3 class="mt-4">Projects List</h3>
        <table class="table table-bordered mt-2">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Client Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for project in projects %}
                <tr>
                    <td>{{ project.name }}</td>
                    <td>{{ project.client_name }}</td>
                    <td>
                        <a href="{% url 'edit_project' project.id %}" class="btn btn-warning btn-sm" >Edit</a>
                        <!-- <button onclick="loadEditProjectForm('{{ project.id }}')" class="btn btn-warning btn-sm">Edit</button> -->
                        <form action="{% url 'delete_project' project.id %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>                    
                        <button class="btn btn-info btn-sm" onclick="showDetails('{{ project.name }}', '{{ project.client_name }}', '{{ project.capacity }}')">Show All</button>
                        <button class="btn btn-success btn-sm" onclick="reviewMachines('{{ project.id }}')">Review Machines</button>
                        <a href="{% url 'generate_report' project.id %}" class="btn btn-secondary btn-sm">Generate Submittal (Word file)</a>
                        <a href="#" class="btn btn-secondary btn-sm disabled" aria-disabled="true">Generate Submittal (PDF)</a>

                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailsModalLabel">Project Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p><strong>Name:</strong> <span id="modalName"></span></p>
                <p><strong>Client Name:</strong> <span id="modalClient"></span></p>
                <p><strong>Capacity:</strong> <span id="modalCapacity"></span></p>
            </div>
        </div>
    </div>
</div>



<!-- Modal -->
<div class="modal fade" id="reviewMachinesModal" tabindex="-1" aria-labelledby="reviewMachinesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reviewMachinesModalLabel">Machines for <span id="modalProjectName"></span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Created At</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody id="machinesTableBody">
                        <!-- Machines will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    /* Change modal background color */
    #machineDetailsModal .modal-content {
        background-color:#d0ebff; /* Light gray */
        color: #000; /* Black text */
    }
</style>

<!-- Machine Details Modal -->
<div class="modal fade" id="machineDetailsModal" tabindex="-1" aria-labelledby="machineDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="machineDetailsModalLabel">Machine Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p><strong>Username:</strong> <span id="detailUsername"></span></p>
                <p><strong>Created At:</strong> <span id="detailCreatedAt"></span></p>
                <p><strong>Type:</strong> <span id="detailType"></span></p>
                <hr>
                <p><strong><span id="labelField1"></span> <span id="points"></span> </strong> <span id="detailField1"></span></p>
                <p><strong><span id="labelField2"></span> <span id="points"></span></strong> <span id="detailField2"></span></p>
                <p><strong><span id="labelField3"></span> <span id="points"></span></strong> <span id="detailField3"></span></p>
                <p><strong><span id="labelField4"></span> <span id="points"></span></strong> <span id="detailField4"></span></p>
                <p><strong><span id="labelField5"></span> <span id="points"></span></strong> <span id="detailField5"></span></p>
                <p><strong><span id="labelField6"></span> <span id="points"></span></strong> <span id="detailField6"></span></p>
                <p><strong><span id="labelField7"></span> <span id="points"></span></strong> <span id="detailField7"></span></p>
                <p><strong><span id="labelField8"></span> <span id="points"></span></strong> <span id="detailField8"></span></p>
                <p><strong><span id="labelField9"></span> <span id="points"></span></strong> <span id="detailField9"></span></p>
                <p><strong><span id="labelField10"></span> <span id="points"></span></strong> <span id="detailField10"></span></p>
            </div>
        </div>
    </div>
</div>


<script>
function showDetails(name, client, capacity) {
    document.getElementById('modalName').textContent = name;
    document.getElementById('modalClient').textContent = client;
    document.getElementById('modalCapacity').textContent = capacity;
    $('#detailsModal').modal('show');
}
</script>


<script>
    function reviewMachines(projectId) {
        document.getElementById('modalProjectName').textContent = "Loading...";
        
        fetch(`/Mechanical/get_machines/${projectId}/`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('modalProjectName').textContent = data.project_name;
    
                let machinesTableBody = document.getElementById('machinesTableBody');
                machinesTableBody.innerHTML = "";  
    
                if (data.machines.length > 0) {
                    data.machines.forEach(machine => {
                        let row = "<tr>";
                        
                        // Loop through each field in the machine object
                        for (const [key, value] of Object.entries(machine)) {
                            if (value !== null && value !== "" ) {
                                row += `<td>${value}</td>`;
                            }
                        }
                    
                        // Add the View Details button (always show this)
                        row += `<td>
                            <button class="btn btn-info btn-sm" onclick="showMachineDetails(${Object.values(machine).map(v => `'${v}'`).join(',')})">
                                View Details
                            </button>
                        </td>`;
                    
                        row += "</tr>";
                        machinesTableBody.innerHTML += row;
                    });
                    
                } else {
                    machinesTableBody.innerHTML = "<tr><td colspan='6' class='text-center'>No machines found.</td></tr>";
                }
    
                $('#reviewMachinesModal').modal('show');
            })
            .catch(error => console.error('Error:', error));
    }

    function showMachineDetails(username, createdAt, type, field1, field2,
    field3, field4, field5, field6, field7,
    field8, field9, field10, field11, field12,
    field13, field14, field15, field16, field17,
    field18, field19, field20) {
        document.getElementById('detailUsername').textContent = username || "N/A";
        document.getElementById('detailCreatedAt').textContent = createdAt || "N/A";
        document.getElementById('detailType').textContent = type || "N/A";
    
        if ((field1) || (field2)) {
            document.getElementById('labelField1').textContent = field1 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field2 || "N/A";
        }
    
        if ((field4) || (field3)) {
            document.getElementById('labelField1').textContent = field3 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field4 || "N/A";
        }
    
        if ((field5) || (field6)) {
            document.getElementById('labelField1').textContent = field5 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field6 || "N/A";
        }
    
        if ((field8) || (field7)) {
            document.getElementById('labelField1').textContent = field7 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field8 || "N/A";
        }
    
        if ((field9) || (field10)) {
            document.getElementById('labelField1').textContent = field9 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field10 || "N/A";
        }
    
        if ((field11) || (field12)) {
            document.getElementById('labelField1').textContent = field11 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field12 || "N/A";
        }
    
        if ((field13) || (field14)) {
            document.getElementById('labelField1').textContent = field13 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field14 || "N/A";
        }
    
        if ((field15) || (field16)) {
            document.getElementById('labelField1').textContent = field15 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field16 || "N/A";
        }
    
        if ((field17) || (field18)) {
            document.getElementById('labelField1').textContent = field17 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field18 || "N/A";
        }
    
        if ((field19) || (field20)) {
            document.getElementById('labelField1').textContent = field19 || "N/A";
            document.getElementById('points').textContent = ":";
            document.getElementById('detailField1').textContent = field20 || "N/A";
        }
    
        $('#machineDetailsModal').modal('show');
    }
    

    
</script>
    
{% endblock %}
